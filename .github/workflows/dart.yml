name: Build iOS IPA

on:
  workflow_dispatch:

jobs:
  build:
    name: üéâ iOS Build (No Codesign)
    runs-on: macos-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: 'stable'
          channel: stable

      - name: Flutter doctor
        run: flutter doctor -v

      - name: Get dependencies
        run: flutter pub get

      - name: Update CocoaPods
        run: pod repo update
        working-directory: ios

      # üîë –í–ê–ñ–ù–û: —Å–±–æ—Ä–∫–∞ –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (iphoneos), –ù–ï —Ç—Ä–µ–±—É–µ—Ç Development Team
      # –ò—Å–ø–æ–ª—å–∑—É–µ–º --release --no-codesign –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ .ipa —Ñ–∞–π–ª–∞
      - name: Build iOS (release, no codesign)
        run: flutter build ios --release --no-codesign

      - name: Create Payload directory
        run: mkdir -p Payload

      - name: Copy app to Payload
        run: cp -R build/ios/iphoneos/Runner.app Payload/

      - name: Create IPA archive
        run: zip -r app.ipa Payload

      - name: Upload IPA artifact
        uses: actions/upload-artifact@v4
        with:
          name: ios-ipa
          path: app.ipa
